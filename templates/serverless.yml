service: MbanqServiceName

plugins:
  - serverless-domain-manager
  - serverless-jest-plugin
  - serverless-offline # serverless-offline needs to be last in the list

package:
  exclude:
    - scripts/**
    - .git/**
    - env.yml

custom:
  stage: ${opt:stage, 'dev'}
  domains:
    prod: ipa.cloud.mbanq.com
    stage: ipa.stage.mbanq.com
    dev: ipa.dev.mbanq.com
    local: localhost
  versions-prod: true
  versions-default: false
  customDomain:
    domainName: ${self:custom.domains.${self:custom.stage}}
    basePath: 'MbanqServiceName'
    stage: ${self:custom.stage}
    createRoute53Record: true
  serverless-offline:
    resourceRoutes: true
    port: 4000
  jest:
    collectCoverage: true

provider:
  name: aws
  runtime: nodejs8.10
  stage: ${self:custom.stage}
  environment: ${file(./env.yml):${self:custom.stage}}
  region: ${file(./env.yml):${self:custom.stage}.REGION}
  versionFunctions: ${self:custom.versions-${self:custom.stage}, self:custom.versions-default}

functions:
  yourfunc:
    handler: handlers.yourfunc
    description: Test function for your service
    events:
      - http:
          path: ''
          method: get
          cors:
            headers:
              - Content-Type
              - X-Amz-Date
              - Authorization
              - X-Amz-Security-Token
              - X-Amz-User-Agent
          # uncomment if you want a cognito authorizer
          # authorizer:
          #  name: authorizer
          #  arn: ${file(./env.yml):${self:custom.stage}.COGNITO_POOL_ARN}
